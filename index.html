<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ödev Portalı</title>
<style>
body{font-family:Arial, sans-serif;padding:20px;}
.hidden{display:none;}
input, textarea{margin:5px 0;padding:5px;width:100%; max-width:400px;}
textarea{height:100px;}
button{padding:5px 10px;margin:5px 0;}
.assignment{border:1px solid #ccc;padding:10px;margin:10px 0;}
</style>
</head>
<body>

<div id="loginPanel">
  <h2>Giriş Yap</h2>
  <input id="user" placeholder="Kullanıcı Adı"><br>
  <input id="pass" type="password" placeholder="Şifre"><br>
  <select id="roleSelect">
    <option value="class">Öğrenci</option>
    <option value="teacher">Hoca</option>
  </select><br>
  <button id="loginBtn">Giriş</button>
</div>

<div id="studentPanel" class="hidden">
  <h2>Öğrenci Paneli</h2>
  <input id="studentName" placeholder="Adınız"><br>
  <textarea id="assignmentArea" placeholder="Ödevinizi yazın"></textarea><br>
  <button id="saveBtn">Kaydet</button>
  <p id="lastSaved"></p>
  <button id="logoutBtn1">Çıkış</button>
</div>

<div id="teacherPanel" class="hidden">
  <h2>Hoca Paneli</h2>
  <div id="assignmentsList"></div>
  <button id="logoutBtn2">Çıkış</button>
</div>

<script type="module">
// Firebase modüllerini import et
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, setDoc, doc, getDocs } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

// Firebase yapılandırma
const firebaseConfig = {
  apiKey: "AIzaSyBYvrxyR8gJLge1uyOSbqy0DRNTZFwOHVw",
  authDomain: "odev-portal.firebaseapp.com",
  projectId: "odev-portal",
  storageBucket: "odev-portal.firebasestorage.app",
  messagingSenderId: "40083187",
  appId: "1:40083187:web:1c14c9cf0293cb5029a186",
  measurementId: "G-WDGHL2S3NQ"
};

// Firebase’i başlat
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Kullanıcı hesapları
const ACCOUNTS=[
  {username:'spideymustafa',password:'42mustafa42',role:'teacher'},
  {username:'sinif',password:'sinifgiris',role:'class'}
];

// Elementler
const loginPanel=document.getElementById("loginPanel");
const studentPanel=document.getElementById("studentPanel");
const teacherPanel=document.getElementById("teacherPanel");
const loginBtn=document.getElementById("loginBtn");
const logoutBtn1=document.getElementById("logoutBtn1");
const logoutBtn2=document.getElementById("logoutBtn2");
const saveBtn=document.getElementById("saveBtn");
const assignmentsList=document.getElementById("assignmentsList");

let currentUser=null;

// Giriş işlemi
loginBtn.onclick=()=>{
  const u=document.getElementById("user").value.trim();
  const p=document.getElementById("pass").value;
  const role=document.getElementById("roleSelect").value;
  const acc=ACCOUNTS.find(a=>a.username===u&&a.password===p&&a.role===role);
  if(!acc){alert("Hatalı kullanıcı adı veya şifre!");return;}
  currentUser=acc;
  loginPanel.classList.add("hidden");
  if(role==="class") studentPanel.classList.remove("hidden");
  else {
    teacherPanel.classList.remove("hidden");
    loadAllAssignments();
  }
};

// Çıkış işlemi
function logout(){
  currentUser=null;
  loginPanel.classList.remove("hidden");
  studentPanel.classList.add("hidden");
  teacherPanel.classList.add("hidden");
  assignmentsList.innerHTML="";
}
logoutBtn1.onclick=logout;
logoutBtn2.onclick=logout;

// Öğrenci ödev kaydı
saveBtn.onclick=async()=>{
  const name=document.getElementById("studentName").value.trim();
  const text=document.getElementById("assignmentArea").value;
  if(!name){alert("Adınızı girin");return;}

  try {
    await setDoc(doc(db,"assignments",name),{
      text:text,
      savedAt:new Date().toISOString()
    });
    document.getElementById("lastSaved").textContent="Kaydedildi: "+new Date().toLocaleString("tr-TR");
    alert("Ödev buluta kaydedildi!");
  } catch(e){
    alert("Kaydetme hatası: "+e.message);
  }
};

// Hoca tüm ödevleri listele
async function loadAllAssignments(){
  assignmentsList.innerHTML="Yükleniyor...";
  try{
    const snap=await getDocs(collection(db,"assignments"));
    assignmentsList.innerHTML="";
    if(snap.empty){assignmentsList.innerHTML="Hiç ödev yok.";}
    snap.forEach(docSnap=>{
      const data=docSnap.data();
      const div=document.createElement("div");
      div.className="assignment";
      div.innerHTML=`<strong>${docSnap.id}</strong><br>${data.text}<br><em>${new Date(data.savedAt).toLocaleString("tr-TR")}</em>`;
      assignmentsList.appendChild(div);
    });
  }catch(e){
    assignmentsList.innerHTML="Ödevleri yüklerken hata: "+e.message;
  }
}
</script>
</body>
</html>