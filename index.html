<script type="module">
  // 1️⃣ Firebase modüllerini import et
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  // 2️⃣ Firebase yapılandırma (senin kodun buraya!)
  const firebaseConfig = {
    apiKey: "AIzaSyBYvrxyR8gJLge1uyOSbqy0DRNTZFwOHVw",
    authDomain: "odev-portal.firebaseapp.com",
    projectId: "odev-portal",
    storageBucket: "odev-portal.firebasestorage.app",
    messagingSenderId: "40083187",
    appId: "1:40083187:web:1c14c9cf0293cb5029a186",
    measurementId: "G-WDGHL2S3NQ"
  };

  // 3️⃣ Firebase’i başlat
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // 4️⃣ Giriş sistemi
  const ACCOUNTS=[
    {username:'hoca',password:'hoca123',role:'teacher'},
    {username:'sinif',password:'sinif123',role:'class'}
  ];

  const loginPanel=document.getElementById("loginPanel");
  const studentPanel=document.getElementById("studentPanel");
  const teacherPanel=document.getElementById("teacherPanel");
  const loginBtn=document.getElementById("loginBtn");
  const logoutBtn1=document.getElementById("logoutBtn1");
  const logoutBtn2=document.getElementById("logoutBtn2");
  const saveBtn=document.getElementById("saveBtn");
  const openBtn=document.getElementById("openBtn");

  let currentUser=null;

  loginBtn.onclick=()=>{
    const u=document.getElementById("user").value.trim();
    const p=document.getElementById("pass").value;
    const role=document.getElementById("roleSelect").value;
    const acc=ACCOUNTS.find(a=>a.username===u&&a.password===p&&a.role===role);
    if(!acc){alert("Hatalı kullanıcı adı veya şifre!");return;}
    currentUser=acc;
    loginPanel.classList.add("hidden");
    if(role==="class")studentPanel.classList.remove("hidden");
    else teacherPanel.classList.remove("hidden");
  };

  function logout(){
    currentUser=null;
    loginPanel.classList.remove("hidden");
    studentPanel.classList.add("hidden");
    teacherPanel.classList.add("hidden");
  }
  logoutBtn1.onclick=logout;
  logoutBtn2.onclick=logout;

  // 5️⃣ Öğrenci ödev kaydı (Firebase'e)
  saveBtn.onclick=async()=>{
    const name=document.getElementById("studentName").value.trim();
    const text=document.getElementById("assignmentArea").value;
    if(!name){alert("Adınızı girin");return;}

    try {
      await setDoc(doc(db,"assignments",name),{
        text:text,
        savedAt:new Date().toISOString()
      });
      document.getElementById("lastSaved").textContent="Kaydedildi: "+new Date().toLocaleString("tr-TR");
      alert("Ödev buluta kaydedildi!");
    } catch(e){
      alert("Kaydetme hatası: "+e.message);
    }
  };

  // 6️⃣ Hoca ödev görüntüleme (Firebase’ten çek)
  openBtn.onclick=async()=>{
    const name=document.getElementById("teacherStudent").value.trim();
    if(!name){alert("İsim girin");return;}
    try {
      const snap=await getDoc(doc(db,"assignments",name));
      if(!snap.exists()){alert("Bu isimle kayıt yok!");return;}
      const data=snap.data();
      document.getElementById("teacherArea").value=data.text;
    } catch(e){
      alert("Veri çekme hatası: "+e.message);
    }
  };
</script>